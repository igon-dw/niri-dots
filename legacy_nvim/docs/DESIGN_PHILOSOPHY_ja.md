# Neovim設定の設計思想

> 生産性と保守性を重視した、AI支援型の現代的なNeovim設定

[English version](./DESIGN_PHILOSOPHY.md)

---

## 🎯 核となる設計原則

### 1. **モジュラーアーキテクチャ**
関心事を明確に分離したクリーンなモジュール構造：

```
nvim/
├── init.lua                 # エントリーポイント
├── lua/
│   ├── config/             # コア設定
│   │   ├── options.lua     # エディタオプション
│   │   ├── keymaps.lua     # キーマッピング
│   │   ├── lazy.lua        # プラグインマネージャー
│   │   └── autocmds.lua    # 自動コマンド
│   └── plugins/            # プラグイン設定（23以上）
│       ├── lsp/            # LSPエコシステム
│       ├── telescope.lua   # ファジーファインダー
│       ├── copilot.lua     # AI支援
│       └── ...
```

**なぜこれが重要か：**
- 各プラグインは独立したファイルに分離
- 他に影響を与えずにプラグインの追加・削除・変更が可能
- コア設定とプラグイン設定の明確な分離

### 2. **遅延読み込み戦略**
[lazy.nvim](https://github.com/folke/lazy.nvim)による最適な起動パフォーマンス：

- 必要な時だけプラグインを読み込む（`event`、`cmd`、`ft`トリガー）
- 依存関係の自動管理
- 典型的な起動時間：**50ms未満**（23以上のプラグイン使用時）

```lua
-- 例：TelescopeはNeovim起動時のみ読み込み
{
  'nvim-telescope/telescope.nvim',
  event = 'VimEnter',
  dependencies = { 'nvim-lua/plenary.nvim' }
}
```

### 3. **AI対応アーキテクチャ**
GitHub Copilotなどのアシスタントと統合可能な設計（オプションアドオン経由）：

- **モジュラーAIサポート**: `nvim-copilot`アドオンをインストールしてAI機能を有効化
- **ベンダーロックインなし**: コア設定は有料サービスなしで動作
- **簡単な有効化**: `stow nvim-copilot`を実行するだけでAI統合を有効化

**アドオンインストール時：**
- コンテキスト認識型のコード補完によるインライン候補
- 対話型AI支援のためのCopilotChat（`<leader>ai`）
- 正確なコンテキストのためのLSPとのシームレスな統合

### 4. **LSP中心の開発**
自動インストール機能付きの完全なLanguage Server Protocolサポート：

**対応言語：**
- Lua (lua_ls)
- Python (pylsp + black/flake8)
- JavaScript/TypeScript (ts_ls)
- Bash (bashls)
- Docker (dockerls)

**Mason統合：**
- LSPサーバーの自動インストール
- フォーマッター: stylua、black、shfmt、markdownlint
- 手動セットアップ不要

**主要LSP機能：**
- `gd` - 定義へジャンプ
- `gr` - 参照を検索
- `<leader>rn` - シンボルのリネーム
- `<leader>ca` - コードアクション
- 保存時の自動フォーマット

---

## 💪 主要な強み

### 1. **発見可能性**
**which-key統合**により全てのキーバインドが発見可能：

- `<leader>`（スペース）を入力して待つだけで全コマンドが表示される
- カテゴリ別に整理：`[S]earch`、`[C]ode`、`[B]uffer`など
- 複雑なキーバインドを暗記する必要なし

```
<leader>s  → [S]earch コマンド群
  ├─ sf → [S]earch [F]iles（ファイル検索）
  ├─ sg → [S]earch by [G]rep（テキスト検索）
  ├─ sh → [S]earch [H]elp（ヘルプ検索）
  └─ ...
```

### 2. **強力な検索機能**
Telescopeがあらゆるものにファジー検索を提供：

- **ファイル**: `<leader>sf`（隠しファイル含む）
- **テキスト**: `<leader>sg`（プロジェクト全体のlive grep）
- **シンボル**: `<leader>ds`（ドキュメント内のシンボル）
- **診断**: `<leader>sd`（エラー/警告）
- **バッファ**: `<leader><leader>`（開いているファイル）

**FZF-native統合**により大規模プロジェクトでも超高速検索。

### 3. **視覚的フィードバック＆UI**
開発体験を向上させる豊富なビジュアル強化：

- **Noice.nvim**: 美しいコマンドラインUI
- **Lualine**: LSPステータス付き情報豊富なステータスライン
- **Bufferline**: タブ風のバッファ管理
- **Indent-blankline**: 視覚的なインデントガイド
- **Gitsigns**: インラインGit差分インジケーター

### 4. **スマートなコードナビゲーション**
効率的にコードを移動する複数の方法：

- **Oil.nvim**: バッファ編集のように使えるファイルエクスプローラー
- **Outline**: シンボルアウトラインサイドバー（`<leader>o`）
- **Telescopeシンボル**: 関数/クラスへの高速ジャンプ
- **Treesitter**: 構文認識型のテキストオブジェクト

### 5. **Git統合**
一級市民としてのGitサポート：

- **Gitsigns**: インライン差分マーカー、hunkプレビュー/ナビゲーション
- **Lazygitトグル**: フル機能のGit TUI（`<leader>tt`）
- Git blame、hunkのステージング、hunkのリセット - 全てNeovimから
- 外部のlazygitともシームレスに連携

### 6. **ターミナル統合**
スマートなキーバインド付き組み込みターミナル：

- `<leader>tf` - フローティングターミナル
- `<leader>th` - 水平分割ターミナル
- `<leader>tv` - 垂直分割ターミナル
- `Esc Esc` - ターミナルモード終了
- Fishシェル統合

---

## 🎨 ユーザーエクスペリエンス設計

### 一貫したキーバインド哲学

**Leaderキー**: `Space`（人間工学的で押しやすい）

**記憶術的グループ化：**
- `<leader>s*` - **Search**（検索）操作
- `<leader>c*` - **Code**（コード）アクション
- `<leader>b*` - **Buffer**（バッファ）管理
- `<leader>h*` - Git **Hunk**（差分）操作
- `<leader>t*` - **Terminal/Toggle**（ターミナル/切替）コマンド

**ウィンドウナビゲーション**: `Ctrl-h/j/k/l`（Vim風、プレフィックス不要）

### スマートなデフォルト設定

```lua
-- 大文字が含まれない限り検索は大文字小文字を区別しない
opt.ignorecase = true
opt.smartcase = true

-- ウィンドウ分割は直感的な方向に
opt.splitright = true  -- 垂直分割は右に
opt.splitbelow = true  -- 水平分割は下に

-- 特殊文字の視覚的フィードバック
opt.list = true
opt.listchars = { tab = '» ', trail = '·', nbsp = '␣' }
```

### 現代的な開発に最適化

- **タブ幅**: 2スペース（Web開発で一般的）
- **サインカラム**: 常時表示（LSP/Gitマーカーでレイアウトシフトなし）
- **マウスサポート**: 全モードで有効（アクセシビリティ）
- **タイムアウト**: 300ms（遅延なく発見可能）

---

## 🔧 カスタマイズ哲学

### 拡張が簡単

**新しいプラグインの追加：**
1. `lua/plugins/your-plugin.lua`を作成
2. プラグイン仕様を返す
3. Neovimを再起動 - lazy.nvimが残りを処理

**新しいLSPの追加：**
```lua
-- lspconfig.luaで
local servers = {
  rust_analyzer = {},  -- この行を追加
  -- ...
}
```

### 削除も簡単

AI支援が不要？`copilot.lua`と`copilotchat.lua`を削除。
テーマが気に入らない？`colorscheme.lua`を置き換え。

**隠れた依存関係なし** - 各プラグインファイルは自己文書化されています。

---

## 🌟 この設定の特別な点

### 1. **第一級市民としてのドキュメント**
- 全てのキーマップに説明あり
- コメントは「何を」だけでなく「なぜ」を説明
- プラグインファイルには目的と使用例を含む
- 複雑な機能にはREADMEファイル

### 2. **バイリンガルサポート**
- 役立つ場所には日本語と英語のコメント
- 日本語説明用のCopilotChatカスタムコマンド
- 多言語開発チームに適している

### 3. **実戦テスト済みのプラグイン選定**
全プラグインは：
- 活発にメンテナンスされている
- 十分にドキュメント化されている
- パフォーマンスが良い（可能な限り遅延読み込み）
- 補完的（機能の重複なし）

### 4. **プログレッシブエンハンスメント**
- すぐに使える素晴らしい動作
- 高度な機能は発見可能だが必須ではない
- 初心者は基本的な編集から始められる
- パワーユーザーはTelescope、LSP、AIを活用できる

---

## 🚀 パフォーマンス特性

- **起動時間**: 約30-50ms（23以上のプラグイン使用時）
- **メモリフットプリント**: 起動時約20-30MB
- **LSP応答性**: ほぼ瞬時（適切な言語サーバー使用時）
- **検索速度**: ほとんどのプロジェクトで100ms未満（telescope-fzf-nativeのおかげ）

---

## 📚 推奨学習パス

1. **初日**: 基本ナビゲーションを学ぶ（`<leader>sf`、`<leader>sg`、`<leader>?`）
2. **1週間目**: LSP機能をマスター（`gd`、`gr`、`<leader>ca`）
3. **2週間目**: AI支援を探索（`<leader>ai`、インライン候補）
4. **1ヶ月目**: プラグインとキーバインドを自分のワークフローにカスタマイズ

---

## 🤝 コントリビューション

この設定は次のように設計されています：
- **フォーク可能**: クローンして自分のニーズにカスタマイズ
- **読みやすい**: 明確な構造とドキュメント
- **保守可能**: モジュラー設計により簡単にアップデート

あなた自身のNeovimの旅の出発点として自由に使用してください！

---

## 📝 ライセンス

この設定は教育および個人使用のために提供されています。
全てのプラグインのクレジットはそれぞれの作者に帰属します。
